{% extends "index.html" %}
{% block content %}
<div class="container my-4">
  <h2 class="fw-bold text-primary mb-4">Purchased</h2>
  
<nav class="navbar navbar-expand-lg bg-dark pt-5 pb-5" style="height: 75px;">
  <div class="container-fluid d-flex justify-content-center">
    <div class="navbar" id="navbarNavAltMarkup">
      <div class="navbar-nav">
        <a class="m-5 h4 text-light {% if selected_status == 'placed order' %}fw-bold text-warning{% endif %}"
           href="{{ url_for('notif.history', status='placed order') }}">Placed Order</a>
        <a class="m-5 h4 text-light {% if selected_status == 'paid' %}fw-bold text-warning{% endif %}"
           href="{{ url_for('notif.history', status='paid') }}">Paid Order</a>
        <a class="m-5 h4 text-light {% if selected_status == 'completed' %}fw-bold text-warning{% endif %}"
           href="{{ url_for('notif.history', status='completed') }}">Completed Order</a>
        <a class="m-5 h4 text-light {% if selected_status == 'history' %}fw-bold text-warning{% endif %}"
           href="{{ url_for('notif.history', status='history') }}">Order History</a>
      </div>
    </div>
  </div>
</nav>


  {% if history %}
    {% for hist in history %}
      <div class="card shadow-sm border-primary border-opacity-25 mt-3 rounded-3 mb-3">
        <div class="card-body d-flex justify-content-between align-items-center">
          <div>
            <h5 class="card-title fw-semibold text-dark">
              Reference Number: <span class="fw-normal text-muted">{{ hist.reference_number }}</span>
            </h5>
            <small class="text-muted"><b>Date:</b> {{ hist.order_date }}</small>
            <br>
            <small class="text-muted"><b>Time:</b> {{ hist.order_time }}</small>
          </div>

          <button class="btn btn-link text-primary p-0 border-0"
                  type="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#historyDetails{{ loop.index }}"
                  aria-expanded="false"
                  aria-controls="historyDetails{{ loop.index }}">
            <i class="bi bi-three-dots-vertical fs-4"></i>
          </button>
        </div>

        <div class="collapse" id="historyDetails{{ loop.index }}">
          <hr class="my-2">
          <div class="card-body pt-0 text-secondary">
            <p class="mb-1"><strong>Status:</strong> {{ hist.status }}</p>
            <p class="mb-1"><strong>Total Amount:</strong> {{ hist.total_amount }}</p>

            {% if hist['items'] %}
              <p class="mb-1"><strong>Items Ordered:</strong></p>
              <ul class="mb-2 ps-2">
                {% for item in hist['items'] %}
                  <li>
                    {{ item.item_name }}
                    {% if item.size != 'N/A' %} - {{ item.size }}{% endif %}
                    - {{ item.quantity }} pcs - Price: {{ item.price }}
                  </li>
                {% endfor %}
              </ul>
            {% else %}
              <p class="text-muted fst-italic">No items available</p>
            {% endif %}
          </div>
        </div>
      </div>
    {% endfor %}
  {% else %}
    <p class="alert alert-info">No order history available.</p>
  {% endif %}
</div>
{% endblock %}