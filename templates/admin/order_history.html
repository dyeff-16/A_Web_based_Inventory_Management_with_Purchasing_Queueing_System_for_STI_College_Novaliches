{% extends "index.html" %}
{% block content %}
<style>
  .hover-shadow:hover {
    box-shadow: 0 0.5rem 1rem rgb(0 0 0 / 0.15);
    transition: box-shadow 0.3s ease-in-out;
  }
  .three-dots {
    cursor: pointer;
    font-size: 1.8rem;
    user-select: none;
    color: #6c757d;
    transition: color 0.2s;
  }
  .three-dots:hover,
  .three-dots:focus {
    color: #0d6efd;
    outline: none;
  }
</style>

<div class="container-fluid mt-5 ms-2 mb-4">
  <form method="POST" action="{{ url_for('orders.order_history') }}">
    <label class="fw-bold" for="search_query">Search:</label>
    <input class="form-control me-2 w-25 d-inline" type="text" id="search_query" name="search_query" placeholder="Enter search query">

    <label class="fw-bold" for="filter_category">Filter by:</label>
    <select class="form-select w-auto d-inline-block" name="filter_category" id="filter_category">
      <option value="name">Name</option>
      <option value="email">Email</option>
      <option value="reference_number">Reference Number</option>
      <option value="date">Date</option>
      <option value="std_id">Student Id</option>
    </select>
    <button class="btn btn-outline-dark mb-1" type="submit">Search</button>
  </form>
</div>

<h2 class="m-3">Order History</h2>

{% if history %}
  {% for histo in history %}
    <div class="container" style="padding-top: 1rem; padding-bottom: 0.25rem;">
      <div class="card shadow-sm border-0 rounded-3 hover-shadow mb-0">
        <div class="card-body d-flex justify-content-between align-items-center">
          <div>
            <h5 class="card-title mb-1 fw-bold">
              Reference Number: <span class="fw-normal">{{ histo.reference_number }}</span>
            </h5>
            <small class="text-muted fst-italic">{{ histo.order_date }}</small>
          </div>
          <span class="three-dots" role="button" tabindex="0" 
                data-bs-toggle="collapse" data-bs-target="#orderDetails{{ loop.index }}"
                aria-expanded="false" aria-controls="orderDetails{{ loop.index }}"
                title="Show order details" aria-label="Toggle order details">â‹¯</span>
        </div>
        <div class="collapse" id="orderDetails{{ loop.index }}">
          <hr class="my-2">
          <div class="card-body pt-0 text-secondary">
            <p class="mb-1"><strong>Email:</strong> {{ histo.email }}</p>
            <p class="mb-1"><strong>Name:</strong> {{ histo.name }}</p>
            <p class="mb-1"><strong>Student ID:</strong> {{ histo.student_id }}</p>
            <p class="mb-1"><strong>Total Amount:</strong> {{ histo.total_amount }}</p>
            <p class="mb-1"><strong>Status:</strong> {{ histo.status }}</p>
            <p class="mb-1"><strong>Date:</strong> {{ histo.order_date }}</p>
            <p class="mb-1"><strong>Time:</strong> {{ histo.order_time }}</p>
            <p class="mb-1"><strong>Items Ordered:</strong></p>
            <ul class="mb-2">
              {%if histo['items']%}
              {% for item in histo['items']%}
                <li>
                  {{ item.item_name }}
                  {% if item.size != 'N/A' %} - {{ item.size }}{% endif %}
                  - {{ item.quantity }} pcs - Price: {{ item.price }}
                </li>
              {% endfor %}
              {%endif%}
            </ul>
          </div>
        </div>
      </div>
    </div>
  {% endfor %}
{% endif %}

{% endblock %}
