{% extends "index.html" %}
{% block content %}
<div class="container my-4">
<div class="container-fluid p-4 bg-light min-vh-100">
    <div class="page-header d-flex justify-content-between align-items-center border-bottom border-secondary mb-4 pb-2">
      <div>
        <h2 class="mb-3"><i class="bi bi-bag-check me-2"></i>My Orders</h2>
      </div>
    </div>

    <div class="bg-transparent rounded-3 shadow-sm mb-4">
      <div class="tab-container d-flex overflow-auto border-bottom"
        style="white-space: nowrap; -webkit-overflow-scrolling: touch;">
        <a href="{{url_for('purchase.purchase')}}" class="tab-link flex-shrink-0" aria-label="View pending orders">
          <i class="bi bi-hourglass-split me-1"></i>
          <span class="d-none d-sm-inline">Orders</span>
          <span class="d-inline d-sm-none">Orders</span>
        </a>
        <a href="{{url_for('purchase.paid')}}" class="tab-link flex-shrink-0" aria-label="View paid orders">
          <i class="bi bi-check-circle me-1"></i>
          <span class="d-none d-sm-inline">Paid</span>
          <span class="d-inline d-sm-none">Paid</span>
        </a>
        <a href="{{url_for('purchase.claim')}}" class="tab-link flex-shrink-0" aria-label="View claimed orders">
          <i class="bi bi-box -seam me-1"></i>
          <span class="d-none d-sm-inline">Claimed</span>
          <span class="d-inline d-sm-none">Claimed</span>
        </a>
        <a href="{{url_for('purchase.order_history')}}" class="tab-link flex-shrink-0" aria-label="View all orders">
          <i class="bi bi-list-ul me-1"></i>
          <span class="d-none d-sm-inline">All Orders</span>
          <span class="d-inline d-sm-none">All</span>
        </a>
      </div>
    </div>
{% if history %}
  {% for histo in history %}
    <div class="container" style="padding-top: 1rem; padding-bottom: 0.25rem;">
      <div class="card shadow-sm border-0 rounded-3 hover-shadow mb-0">
        <div class="card-body d-flex justify-content-between align-items-center">
          <div>
            <h5 class="card-title mb-1 fw-bold">
              Reference Number: <span class="fw-normal">{{ histo.reference_number }}</span>
            </h5>
            <small class="text-muted fst-italic">{{ histo.order_date }}</small>
          </div>
          <span class="three-dots" role="button" tabindex="0" 
                data-bs-toggle="collapse" data-bs-target="#orderDetails{{ loop.index }}"
                aria-expanded="false" aria-controls="orderDetails{{ loop.index }}"
                title="Show order details" aria-label="Toggle order details">â‹¯</span>
        </div>
        <div class="collapse" id="orderDetails{{ loop.index }}">
          <hr class="my-2">
          <div class="card-body pt-0 text-secondary">
            <p class="mb-1"><strong>Email:</strong> {{ histo.email }}</p>
            <p class="mb-1"><strong>Name:</strong> {{ histo.name }}</p>
            <p class="mb-1"><strong>Student ID:</strong> {{ histo.student_id }}</p>
            <p class="mb-1"><strong>Total Amount:</strong> {{ histo.total_amount }}.00</p>
            <p class="mb-1"><strong>Status:</strong> {{ histo.status }}</p>
            <p class="mb-1"><strong>Date:</strong> {{ histo.order_date }}</p>
            <p class="mb-1"><strong>Time:</strong> {{ histo.order_time }}</p>
            <p class="mb-1"><strong>Items Ordered:</strong></p>
            <ul class="mb-2">
              {%if histo['items']%}
              {% for item in histo['items']%}
                <li>
                  {{ item.item_name }}
                  {% if item.size != 'N/A' %} - {{ item.size }}{% endif %}
                  - {{ item.quantity }} pcs - Price: {{ item.price }}.00
                </li>
              {% endfor %}
              {%endif%}
            </ul>
          </div>
        </div>
      </div>
    </div>
  {% endfor %}
{% endif %}
  <style>
        .tab-container {
          padding: 0.5rem 0;
        }

        .tab-link {
          display: flex;
          align-items: center;
          padding: 0.75rem 1rem;
          text-decoration: none;
          color: #6c757d;
          border-radius: 0.5rem;
          transition: background-color 0.2s ease, color 0.2s ease;
          font-weight: 500;
        }

        .tab-link:hover {
          background-color: #f8f9fa;
          color: #495057;
        }

        .tab-link.active {
          background-color: transparent;
          color: #0d6efd;
        }

        .tab-link.active:hover {
          background-color: #f8f9fa;
        }

        @media (max-width: 576px) {
          .tab-link {
            padding: 0.5rem 0.75rem;
            font-size: 0.9rem;
          }

          .tab-container {
            padding: 0.25rem 0;
          }
        }

        .order-card {
          transition: all 0.3s ease;
          border: 2px solid transparent;
        }

        .order-card:hover {
          border-color: #0d6efd;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
          transform: translateY(-2px);
          /* Subtle lift on hover */
        }

        .card {
          border-radius: 0.75rem;
        }

        .modal-content {
          border-radius: 0.75rem;
        }

        /* Mobile adjustments */
        @media (max-width: 768px) {
          .order-card .row {
            text-align: center;
          }

          .btn-group {
            flex-direction: column;
            width: 100%;
          }

          .btn-group .btn {
            margin-bottom: 0.5rem;
          }
        }
      </style>
{% endblock %}